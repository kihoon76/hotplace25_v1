/*
 * The MIT License (MIT)
 * Copyright (c) 2014 vadimsva
 */
!function(e){e.fn.waitMe=function(t){return this.each(function(){function o(){var e=d.attr("data-waitme_id");d.removeClass(f+"_container").removeAttr("data-waitme_id"),d.find("."+f+'[data-waitme_id="'+e+'"]').remove()}var i,a,r,s,n,c,d=e(this),f="waitMe",l=!1,u="background-color",v="",b="",m={init:function(){function o(e){y.css({top:"auto",transform:"translateY("+e+"px) translateZ(0)"})}var m={effect:"bounce",text:"",bg:"rgba(255,255,255,0.7)",color:"#000",maxSize:"",textPos:"vertical",fontSize:"",source:"",onClose:function(){}};switch(n=e.extend(m,t),c=(new Date).getMilliseconds(),s=e('<div class="'+f+'" data-waitme_id="'+c+'"></div>'),n.effect){case"none":r=0;break;case"bounce":r=3;break;case"rotateplane":r=1;break;case"stretch":r=5;break;case"orbit":r=2,l=!0;break;case"roundBounce":r=12;break;case"win8":case"win8_linear":r=5,l=!0;break;case"ios":r=12;break;case"facebook":r=3;break;case"rotation":r=1,u="border-color";break;case"timer":if(r=2,e.isArray(n.color))w=n.color[0];else w=n.color;v="border-color:"+w;break;case"pulse":r=1,u="border-color";break;case"progressBar":r=1;break;case"bouncePulse":r=3;break;case"img":r=1}if(""!==v&&(v+=";"),r>0){if("img"===n.effect)b='<img src="'+n.source+'">';else for(var h=1;h<=r;++h){if(e.isArray(n.color))void 0==(w=n.color[h])&&(w="#000");else w=n.color;b+=l?'<div class="'+f+"_progress_elem"+h+'"><div style="'+u+":"+w+'"></div></div>':'<div class="'+f+"_progress_elem"+h+'" style="'+u+":"+w+'"></div>'}a=e('<div class="'+f+"_progress "+n.effect+'" style="'+v+'">'+b+"</div>")}if(n.text){if(e.isArray(n.color))w=n.color[0];else var w=n.color;if(""!=n.fontSize)g="font-size:"+n.fontSize;else var g="";i=e('<div class="'+f+'_text" style="color:'+w+";"+g+'">'+n.text+"</div>")}var p=d.find("> ."+f);p&&p.remove();var x=e('<div class="'+f+"_content "+n.textPos+'"></div>');x.append(a,i),s.append(x),"HTML"==d[0].tagName&&(d=e("body")),d.addClass(f+"_container").attr("data-waitme_id",c).append(s),p=d.find("> ."+f);var y=d.find("."+f+"_content");if(p.css({background:n.bg}),""!==n.maxSize&&"none"!=n.effect){var _=a.outerHeight(),k=(a.outerWidth(),_);if("img"===n.effect)a.css({height:n.maxSize+"px"}),a.find(">img").css({maxHeight:"100%"}),y.css({marginTop:-y.outerHeight()/2+"px"});else if(n.maxSize<k)if("stretch"==n.effect)a.css({height:n.maxSize+"px",width:n.maxSize+"px"}),a.find("> div").css({margin:"0 5%"});else{var M=n.maxSize/k-.2,z="-50%";"roundBounce"==n.effect?(z="-75%",n.text&&(z="75%")):"win8"==n.effect||"timer"==n.effect||"orbit"==n.effect?(z="-20%",n.text&&(z="20%")):"ios"==n.effect&&(z="-15%",n.text&&(z="15%")),"rotation"==n.effect&&n.text&&(z="75%"),a.css({transform:"scale("+M+") translateX("+z+")",whiteSpace:"nowrap"})}}if(y.css({marginTop:-y.outerHeight()/2+"px"}),d.outerHeight()>e(window).height()){var S=e(window).scrollTop(),C=y.outerHeight(),H=d.offset().top,T=d.outerHeight(),A=S-H+e(window).height()/2;A<0&&(A=Math.abs(A)),A-C>=0&&A+C<=T?(H-S>e(window).height()/2&&(A=C),o(A)):o(A=S>H+T-C?S-H-C:S-H+C),e(document).scroll(function(){var t=e(window).scrollTop()-H+e(window).height()/2;t-C>=0&&t+C<=T&&o(t)})}return p.on("destroyed",function(){n.onClose&&e.isFunction(n.onClose)&&n.onClose(),p.trigger("close")}),e.event.special.destroyed={remove:function(e){e.handler&&e.handler()}},p},hide:function(){o()}};return m[t]?m[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void 0:m.init.apply(this,arguments)})},e(window).on("load",function(){e("body.waitMe_body").addClass("hideMe"),setTimeout(function(){e("body.waitMe_body").find(".waitMe_container:not([data-waitme_id])").remove(),e("body.waitMe_body").removeClass("waitMe_body hideMe")},200)})}(jQuery);